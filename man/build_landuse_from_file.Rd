% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/landuse.R
\name{build_landuse_from_file}
\alias{build_landuse_from_file}
\title{Build land-use summary at arbitrary polygon boundaries (and per CMA-year)}
\usage{
build_landuse_from_file(
  boundaries,
  base_dir = "calculated_ignore/landuse_v3",
  mapping = data.table::data.table(folder = c("QBC", "VIC", "VAN", "CGY", "EDM", "WPG",
    "HMT", "TOR", "OTTGTU", "MTL", "HRM"), region = c("qc_quebec", "bc_victoria",
    "bc_vancouver", "ab_calgary", "ab_edmonton", "mb_winnipeg", "on_hamilton",
    "on_toronto", "on_ottawa", "qc_montreal", "ns_halifax"), CMA_UID = c(24421, 59935,
    59933, 48825, 48835, 46602, 35537, 35535, 505, 24462, 12205)),
  pattern_year = "\\\\d{4}",
  exact = FALSE,
  use_data_table = TRUE,
  progress = TRUE
)
}
\arguments{
\item{base_dir}{Character scalar. Root folder containing CMA subfolders.}

\item{mapping}{Data.frame with required columns: "folder" (subfolder name)
and "CMA_UID" (character or numeric id). Extra columns are ignored.}

\item{pattern_year}{Character scalar. Regex to extract a 4-digit year
from filenames. Default "\\\\d{4}".}

\item{exact}{Logical scalar. If TRUE, use exact area fractions in
intersections (slower, more accurate). If FALSE, count cell centers.}

\item{use_data_table}{Logical. Whether to use data.table for output
(recommended for performance).}

\item{progress}{Logical. Whether to show progress messages.}

\item{census_scale}{<\verb{sf data.frame}> Dataframe at which to calculate landuse.}
}
\value{
Data.frame. When \code{boundaries} is NULL, one row per CMA-year.
When \code{boundaries} is provided, one row per (polygon id, CMA-year).
Columns:
\describe{
\item{cma_id}{CMA UID as character}
\item{year}{4-digit year (NA if not found)}
\item{id}{polygon id (only when \code{boundaries} provided)}
\item{\emph{\emph{pct}{percentages (0..1) for categories 1..5}
\item{landuse}}}{raw counts for categories 1..5}
}
}
\description{
Scans a root directory of CMA subfolders (e.g., "MTL", "CGY"), loads each
land-use raster, and computes category counts and percentages for values
1..5 (lowrise, midrise, highrise, nonres, nonbuilt).
}
\details{
If \code{boundaries} is provided, computes the stats for each polygon in that
\code{sf} object (after reprojection to the raster CRS) for every raster file
found. Otherwise, returns one row per CMA-year file (total over all cells).

The function processes raster files in parallel using future.apply.
Set up your parallel backend before calling this function:
\code{future::plan(future::multisession, workers = n_cores)}
}
